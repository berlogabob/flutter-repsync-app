# ================================================
# Makefile –¥–ª—è –¥–µ–ø–ª–æ—è Flutter Web ‚Üí GitHub Pages
# –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ macOS –∏ Linux
# ================================================

# === –ù–ê–°–¢–†–û–ô–ö–ò (–∏–∑–º–µ–Ω–∏ —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å, –µ—Å–ª–∏ –Ω–∞–¥–æ) ===
REPO_NAME     := flutter-repsync-app
BASE_HREF     := /$(REPO_NAME)/

# ================================================

.PHONY: deploy build-web clean help

# –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –∫–ª–∏–∫–µ
deploy:
	@echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É –¥–ª—è GitHub Pages..."
	flutter build web --release --base-href $(BASE_HREF)
	
	@echo "üìÅ –ö–æ–ø–∏—Ä—É–µ–º —Å–±–æ—Ä–∫—É –≤ –ø–∞–ø–∫—É docs..."
	rm -rf docs/*
	cp -r build/web/* docs/
	
	@echo "üõ°Ô∏è –°–æ–∑–¥–∞—ë–º .nojekyll (—á—Ç–æ–±—ã _flutter –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª—Å—è)..."
	touch docs/.nojekyll
	
	@echo "üîÑ –°–æ–∑–¥–∞—ë–º 404.html –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ SPA-—Ä–æ—É—Ç–∏–Ω–≥–∞..."
	cp docs/index.html docs/404.html
	
	@echo ""
	@echo "‚úÖ –ì–û–¢–û–í–û!"
	@echo "   –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://berlogabob.github.io/$(REPO_NAME)/"
	@echo ""
	@echo "–¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω–∏:"
	@echo "   git add docs/"
	@echo "   git commit -m \"Deploy: update GitHub Pages\""
	@echo "   git push"

# –ü—Ä–æ—Å—Ç–æ —Å–æ–±—Ä–∞—Ç—å –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
build-web:
	flutter build web --release --base-href $(BASE_HREF)

# –û—á–∏—Å—Ç–∫–∞
clean:
	rm -rf build/web docs/*

# –ü–æ–º–æ—â—å
help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make deploy     ‚Üí –ø–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ docs + .nojekyll + 404.html"
	@echo "  make build-web  ‚Üí —Ç–æ–ª—å–∫–æ —Å–±–æ—Ä–∫–∞ Flutter Web"
	@echo "  make clean      ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å build –∏ docs"
	@echo "  make help       ‚Üí —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
